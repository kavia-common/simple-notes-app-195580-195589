{"is_source_file": true, "format": "Python", "description": "This file contains functions and setup code for establishing and managing database connections using SQLAlchemy. It includes logic for reading connection URLs from environment variables, files, and defaults, normalizing URLs, and creating SQLAlchemy engine and session objects.", "external_files": ["sqlalchemy", "sqlalchemy.engine", "sqlalchemy.orm", "pathlib.Path", "os"], "external_methods": ["create_engine", "make_url"], "published": ["get_db"], "classes": [], "methods": [{"name": "str _normalize_sqlalchemy_postgres_url(url: str)", "description": "Normalizes a PostgreSQL URL to ensure it includes the 'psycopg2' driver notation, replacing 'postgresql://' with 'postgresql+psycopg2://'.", "scope": "", "scopeKind": ""}, {"name": "str|None _read_db_connection_txt()", "description": "Reads a database connection URL from a sibling container's 'db_connection.txt' file, if present, and normalizes it.", "scope": "", "scopeKind": ""}, {"name": "str|None _env_postgres_url_if_usable()", "description": "Fetches the PostgreSQL URL from environment variable 'POSTGRES_URL', ensuring it contains credentials (username and password). Returns normalized URL or None.", "scope": "", "scopeKind": ""}, {"name": "str _build_database_url()", "description": "Constructs the database URL by checking environment variables, reading from a file, or falling back to defaults.", "scope": "", "scopeKind": ""}, {"name": "get_db()", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["make_url", "create_engine", "sessionmaker", "Path.resolve", "Path.exists", "Path.read_text", "os.getenv"], "search-terms": ["SQLAlchemy database connection", "PostgreSQL URL normalization", "database connection file", "environment variable POSTGRES_URL", "db_connection.txt"], "state": 2, "file_id": 5, "knowledge_revision": 19, "git_revision": "f0b3a7508ea68cce8115da9f03cb8b2edf709145", "revision_history": [{"12": ""}, {"17": "259bf64826dc3115a1f74dce100016980d1baa60"}, {"19": "f0b3a7508ea68cce8115da9f03cb8b2edf709145"}], "ctags": [{"_type": "tag", "name": "Base", "path": "/home/kavia/workspace/code-generation/simple-notes-app-195580-195589/notes_backend/src/db.py", "pattern": "/^Base = declarative_base()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "DATABASE_URL", "path": "/home/kavia/workspace/code-generation/simple-notes-app-195580-195589/notes_backend/src/db.py", "pattern": "/^DATABASE_URL = _build_database_url()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SessionLocal", "path": "/home/kavia/workspace/code-generation/simple-notes-app-195580-195589/notes_backend/src/db.py", "pattern": "/^SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_build_database_url", "path": "/home/kavia/workspace/code-generation/simple-notes-app-195580-195589/notes_backend/src/db.py", "pattern": "/^def _build_database_url() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_env_postgres_url_if_usable", "path": "/home/kavia/workspace/code-generation/simple-notes-app-195580-195589/notes_backend/src/db.py", "pattern": "/^def _env_postgres_url_if_usable() -> str | None:$/", "language": "Python", "typeref": "typename:str|None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_normalize_sqlalchemy_postgres_url", "path": "/home/kavia/workspace/code-generation/simple-notes-app-195580-195589/notes_backend/src/db.py", "pattern": "/^def _normalize_sqlalchemy_postgres_url(url: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(url: str)"}, {"_type": "tag", "name": "_read_db_connection_txt", "path": "/home/kavia/workspace/code-generation/simple-notes-app-195580-195589/notes_backend/src/db.py", "pattern": "/^def _read_db_connection_txt() -> str | None:$/", "language": "Python", "typeref": "typename:str|None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "engine", "path": "/home/kavia/workspace/code-generation/simple-notes-app-195580-195589/notes_backend/src/db.py", "pattern": "/^engine = create_engine($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "get_db", "path": "/home/kavia/workspace/code-generation/simple-notes-app-195580-195589/notes_backend/src/db.py", "pattern": "/^def get_db():$/", "language": "Python", "kind": "function", "signature": "()"}], "hash": "a5fa9e9d064bb8ffdd81c8a9a5cdcd69", "format-version": 4, "code-base-name": "notes_backend", "filename": "notes_backend/src/db.py", "fields": [{"name": "Base = declarative_base()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "DATABASE_URL = _build_database_url()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "engine = create_engine(", "scope": "", "scopeKind": "", "description": "unavailable"}]}